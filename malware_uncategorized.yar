rule malware_opendir_june_25 {
   meta:
      description = "opendir"
      author = "LightDefender"
      date = "2021-06-25"
      hash1 = "1ac909cef8e454178e18a5c5fa84760d4fb0233651a6365db15581387733aabc"
      hash2 = "c42172b4cef51a701d613ec6b932b6196ce557f4568360a3cb6a1a365161852b"
      hash3 = "50a65c497c8306ba179deb6e97669ed6e7b18b994f9008bc1f878c4617407898"
      hash4 = "55fbde2524b2528af0d6ff6e0bb1b017b2fb70451a29e952d7c1874b5deb9d9f"
      hash5 = "c8316290f86ab619e67d1196b39b88fa21e2534830357f455cc4ed7e9cec4e20"
      hash6 = "c0a3383b2bbc00b00bd99bb23833f573d0ee1c6ec78ae9548716a801bf01cace"
      hash7 = "71a7111ff8364335886e49e473cd070b7127cf3cd3fcabd9f9ec405c5a600572"
      hash8 = "2beba1a84ca6a357ff2e8fb49b014523c855b73195e04829db7ee94afe87ecd8"
      hash9 = "f942da2bd36afd4696e8ec09663fea116fa144bb331d244f6189a700a7e82229"
      hash10 = "7fd56bc08ad3ebae244a899150462d6eb0ffaad711e378b4eb2710e51807efd3"
      hash11 = "f24f2c5b077d2ab2160c2fb38c83949e7dd95a565eb095666f5d375a7acbdd91"
   strings:
      $s1 = "asdasddsa.exe" fullword wide
      $s2 = "GetLenToPosState" fullword ascii
      $s3 = "Decoder2" fullword ascii
      $s4 = "BitTreeDecoder" fullword ascii
      $s5 = "LzmaDecoder" fullword ascii
      $s6 = "LiteralDecoder" fullword ascii
      $s7 = "LenDecoder" fullword ascii
      $s8 = "BitDecoder" fullword ascii
      $s9 = "UpdateChar" fullword ascii
      $s10 = "OutWindow" fullword ascii
      $s11 = "UpdateMatch" fullword ascii
      $s12 = "_windowSize" fullword ascii
      $s13 = "SetPosBitsProperties" fullword ascii
      $s14 = "IsCharState" fullword ascii
      $s15 = "m_Choice2" fullword ascii
      $s16 = "_solid" fullword ascii
      $s17 = "1.0.1.02" fullword wide
      $x1 = {00 ?? 03 00 00 04 00 00 00 00 00 00 02 00 40 85 00 00 10 00 00 10 00 00 00 00 10}
   condition:
      ( uint16(0) == 0x5a4d and filesize < 500KB and ( 15 of them ) and $x1 at 0xd0
      ) or ( all of them )
}

rule malware_phantom2_exe {
   meta:
      description = "from urlhaus (phantom2.exe)"
      author = "LightDefender"
      reference = "https://urlhaus.abuse.ch/url/1281110/"
      date = "2021-06-25"
   strings:
      $s1 = {558BEC83EC08DD4508DD1C24E8EF01000083C408}
      $s2 = {8B450850FF155411420085C0750BFF15CC104200}
      $s3 = {558BEC6AFF68680D420064A1000000005083EC24}
      $s4 = {558BEC51D9450883EC08DD1C24E8EE02000083C4}
      $s5 = {CCCCCCCCCCCCCCCCCCCCCCCCCCCCCC558BEC51D9}
   condition:
      uint16(0) == 0x5a4d and all of them
 }
