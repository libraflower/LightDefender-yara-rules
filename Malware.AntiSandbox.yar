rule mal_antisandbox {
   meta:
      description = "Malware.AntiSandbox"
      author = "LightDefender"
      date = "2021-06-13"
      hash1 = "98d1cb97b2fd5c50dd5fd88d85d3bc8bce72da6ab1c2d0451dd10f607ed434ef"
   strings:
      $x1 = "cmd.exe /c start /B powershell -windowstyle hidden -command \"&{$t='#i#ex##@(n#ew###-#ob#jec#t N#et#.W#eb#Cl#ie#nt#).#Up#loa#dSt" ascii
      $x2 = "<assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\"><assemblyIdentity version=\"1.0.0.0\" processorArch" ascii
      $x3 = "mblyIdentity type=\"win32\" name=\"Microsoft.Windows.Common-Controls\" version=\"6.0.0.0\" processorArchitecture=\"*\" publicKey" ascii
      $x4 = "ProcessHacker.exe" fullword ascii
      $s1 = "api-ms-win-core-synch-l1-2-0.dll" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */
      $s2 = "C:\\SampleDLL.dll" fullword ascii
      $s3 = "dumpcap.exe" fullword ascii
      $s4 = "wpespy.dll" fullword ascii
      $s5 = "cmdvrt32.dll" fullword ascii
      $s6 = "cmdvrt64.dll" fullword ascii
      $s7 = "ImportREC.exe" fullword ascii
      $s8 = "autorunsc.exe" fullword ascii
      $s9 = "xenservice.exe" fullword ascii
      $s10 = "SandboxieDcomLaunch.exe" fullword ascii
      $s11 = "httpdebugger.exe" fullword ascii
      $s12 = "autoruns.exe" fullword ascii
      $s13 = "sniff_hit.exe" fullword ascii
      $s14 = "sbiedll.dll" fullword ascii
      $s15 = "vmcheck.dll" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 3000KB and
      (1 of ($x*) and 3 of them) or 6 of them
}
